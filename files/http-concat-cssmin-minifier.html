<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>VIP Go mu-plugins</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <base href="../">
    <link rel="icon" href="images/favicon.ico"/>
    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/base.css">
            <link rel="preconnect" href="https://fonts.gstatic.com">
        <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@400;600;700&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:wght@400;600;700&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="css/template.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0/css/all.min.css" integrity="sha256-ybRkN9dBjhcS2qrW1z+hfCxq+1aBdwyQM5wlQoQVt/0=" crossorigin="anonymous" />
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/themes/prism-okaidia.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/line-numbers/prism-line-numbers.css">
            <script src="js/prism.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            window.dispatchEvent(new HashChangeEvent('hashchange'));
        });
    </script>
</head>
<body id="top">
    <header class="phpdocumentor-header phpdocumentor-section">
    <h1 class="phpdocumentor-title"><a href="" class="phpdocumentor-title__link">VIP Go mu-plugins</a><span class="title-separator">/</span>mu-plugins</h1>
    <input class="phpdocumentor-header__menu-button" type="checkbox" id="menu-button" name="menu-button" />
    <label class="phpdocumentor-header__menu-icon" for="menu-button">
        <i class="fas fa-bars"></i>
    </label>
    <section data-search-form class="phpdocumentor-search">
    <label>
        <span class="visually-hidden">Search for</span>
        <svg class="phpdocumentor-search__icon" width="21" height="20" viewBox="0 0 21 20" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="7.5" cy="7.5" r="6.5" stroke="currentColor" stroke-width="2"/>
            <line x1="12.4892" y1="12.2727" x2="19.1559" y2="18.9393" stroke="currentColor" stroke-width="3"/>
        </svg>
        <input type="search" class="phpdocumentor-field phpdocumentor-search__field" placeholder="Loading .." disabled />
    </label>
</section>

    <nav class="phpdocumentor-topnav">
    <ul class="phpdocumentor-topnav__menu">
        </ul>
</nav>
</header>

    <main class="phpdocumentor">
        <div class="phpdocumentor-section">
            <input class="phpdocumentor-sidebar__menu-button" type="checkbox" id="sidebar-button" name="sidebar-button" />
<label class="phpdocumentor-sidebar__menu-icon" for="sidebar-button">
    Menu
</label>
<aside class="phpdocumentor-column -four phpdocumentor-sidebar">
        
    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Namespaces</h2>
                                <h3 class="phpdocumentor-sidebar__root-namespace"><a href="namespaces/default.html"><abbr title="\">Global</abbr></a></h3>
                                        <h4 class="phpdocumentor-sidebar__root-namespace"><a href="namespaces/automattic.html"><abbr title="\Automattic">Automattic</abbr></a></h4>
                <ul class="phpdocumentor-list">
                                            <li><a href="namespaces/automattic-wp.html"><abbr title="\Automattic\WP">WP</abbr></a></li>
                                            <li><a href="namespaces/automattic-vip.html"><abbr title="\Automattic\VIP">VIP</abbr></a></li>
                                    </ul>
                            <h4 class="phpdocumentor-sidebar__root-namespace"><a href="namespaces/tubalmartin.html"><abbr title="\tubalmartin">tubalmartin</abbr></a></h4>
                <ul class="phpdocumentor-list">
                                            <li><a href="namespaces/tubalmartin-cssmin.html"><abbr title="\tubalmartin\CssMin">CssMin</abbr></a></li>
                                    </ul>
                        </section>

        <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Packages</h2>
                    <h3 class="phpdocumentor-sidebar__root-package"><a href="packages/VIP.html"><abbr title="\VIP">VIP</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="packages/a8c.html"><abbr title="\a8c">a8c</abbr></a></h3>
                        <ul class="phpdocumentor-list">
                                    <li><a href="packages/a8c-Cron.html"><abbr title="\a8c\Cron">Cron</abbr></a></li>
                            </ul>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="packages/Http.html"><abbr title="\Http">Http</abbr></a></h3>
                        <ul class="phpdocumentor-list">
                                    <li><a href="packages/Http-Concat.html"><abbr title="\Http\Concat">Concat</abbr></a></li>
                            </ul>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="packages/ES.html"><abbr title="\ES">ES</abbr></a></h3>
                        <ul class="phpdocumentor-list">
                                    <li><a href="packages/ES-WP.html"><abbr title="\ES\WP">WP</abbr></a></li>
                            </ul>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="packages/wp.html"><abbr title="\wp">wp</abbr></a></h3>
                        <ul class="phpdocumentor-list">
                                    <li><a href="packages/wp-cli.html"><abbr title="\wp\cli">cli</abbr></a></li>
                            </ul>
                        </section>
    
    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Reports</h2>
                <h3 class="phpdocumentor-sidebar__root-package"><a href="reports/deprecated.html">Deprecated</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="reports/errors.html">Errors</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="reports/markers.html">Markers</a></h3>
    </section>

    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Indices</h2>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="indices/files.html">Files</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="hooks/hooks.html">Hooks</a></h3>
    </section>
</aside>

            <div class="phpdocumentor-column -eight phpdocumentor-content">
                    <ul class="phpdocumentor-breadcrumbs">
    </ul>

    <article class="phpdocumentor-element -file">
        <h2 class="phpdocumentor-content__title">Minifier.php</h2>

        






<h3 id="interfaces_class_traits">
    Interfaces, Classes and Traits
    <a href="#interfaces_class_traits" class="headerlink"><i class="fas fa-link"></i></a>
</h3>

<dl class="phpdocumentor-table-of-contents">
    
            <dt class="phpdocumentor-table-of-contents__entry -class"><a href="classes/tubalmartin-CssMin-Minifier.html"><abbr title="\tubalmartin\CssMin\Minifier">Minifier</abbr></a></dt>
        <dd></dd>
    
    </dl>





        

        
                    <h3 class="phpdocumentor-elements__header" id="source-code">
                Source code
                <a href="#source-code" class="headerlink"><i class="fas fa-link"></i></a>
            </h3>
            <pre id="source-view" tabindex="-1" class="language-php line-numbers linkable-line-numbers"><code>&lt;?php

/*!
 * CssMin
 * Author: Tubal Martin - http://tubalmartin.me/
 * Repo: https://github.com/tubalmartin/YUI-CSS-compressor-PHP-port
 *
 * This is a PHP port of the CSS minification tool distributed with YUICompressor,
 * itself a port of the cssmin utility by Isaac Schlueter - http://foohack.com/
 * Permission is hereby granted to use the PHP version under the same
 * conditions as the YUICompressor.
 */

/*!
 * YUI Compressor
 * http://developer.yahoo.com/yui/compressor/
 * Author: Julien Lecomte - http://www.julienlecomte.net/
 * Copyright (c) 2013 Yahoo! Inc. All rights reserved.
 * The copyrights embodied in the content of this file are licensed
 * by Yahoo! Inc. under the BSD (revised) open source license.
 */

namespace tubalmartin\CssMin;

class Minifier
{
    const QUERY_FRACTION = &#039;_CSSMIN_QF_&#039;;
    const COMMENT_TOKEN = &#039;_CSSMIN_CMT_%d_&#039;;
    const COMMENT_TOKEN_START = &#039;_CSSMIN_CMT_&#039;;
    const RULE_BODY_TOKEN = &#039;_CSSMIN_RBT_%d_&#039;;
    const PRESERVED_TOKEN = &#039;_CSSMIN_PTK_%d_&#039;;
    
    // Token lists
    private $comments = array();
    private $ruleBodies = array();
    private $preservedTokens = array();
    
    // Output options
    private $keepImportantComments = true;
    private $keepSourceMapComment = false;
    private $linebreakPosition = 0;
    
    // PHP ini limits
    private $raisePhpLimits;
    private $memoryLimit;
    private $maxExecutionTime = 60; // 1 min
    private $pcreBacktrackLimit;
    private $pcreRecursionLimit;
    
    // Color maps
    private $hexToNamedColorsMap;
    private $namedToHexColorsMap;
    
    // Regexes
    private $numRegex;
    private $charsetRegex = &#039;/@charset [^;]+;/Si&#039;;
    private $importRegex = &#039;/@import [^;]+;/Si&#039;;
    private $namespaceRegex = &#039;/@namespace [^;]+;/Si&#039;;
    private $namedToHexColorsRegex;
    private $shortenOneZeroesRegex;
    private $shortenTwoZeroesRegex;
    private $shortenThreeZeroesRegex;
    private $shortenFourZeroesRegex;
    private $unitsGroupRegex = &#039;(?:ch|cm|em|ex|gd|in|mm|px|pt|pc|q|rem|vh|vmax|vmin|vw|%)&#039;;

    /**
     * @param bool|int $raisePhpLimits If true, PHP settings will be raised if needed
     */
    public function __construct($raisePhpLimits = true)
    {
        $this-&gt;raisePhpLimits = (bool) $raisePhpLimits;
        $this-&gt;memoryLimit = 128 * 1048576; // 128MB in bytes
        $this-&gt;pcreBacktrackLimit = 1000 * 1000;
        $this-&gt;pcreRecursionLimit = 500 * 1000;
        $this-&gt;hexToNamedColorsMap = Colors::getHexToNamedMap();
        $this-&gt;namedToHexColorsMap = Colors::getNamedToHexMap();
        $this-&gt;namedToHexColorsRegex = sprintf(
            &#039;/([:,( ])(%s)( |,|\)|;|$)/Si&#039;,
            implode(&#039;|&#039;, array_keys($this-&gt;namedToHexColorsMap))
        );
        $this-&gt;numRegex = sprintf(&#039;-?\d*\.?\d+%s?&#039;, $this-&gt;unitsGroupRegex);
        $this-&gt;setShortenZeroValuesRegexes();
    }

    /**
     * Parses &amp; minifies the given input CSS string
     * @param string $css
     * @return string
     */
    public function run($css = &#039;&#039;)
    {
        if (empty($css) || !is_string($css)) {
            return &#039;&#039;;
        }

        $this-&gt;resetRunProperties();

        if ($this-&gt;raisePhpLimits) {
            $this-&gt;doRaisePhpLimits();
        }

        return $this-&gt;minify($css);
    }

    /**
     * Sets whether to keep or remove sourcemap special comment.
     * Sourcemap comments are removed by default.
     * @param bool $keepSourceMapComment
     */
    public function keepSourceMapComment($keepSourceMapComment = true)
    {
        $this-&gt;keepSourceMapComment = (bool) $keepSourceMapComment;
    }

    /**
     * Sets whether to keep or remove important comments.
     * Important comments outside of a declaration block are kept by default.
     * @param bool $removeImportantComments
     */
    public function removeImportantComments($removeImportantComments = true)
    {
        $this-&gt;keepImportantComments = !(bool) $removeImportantComments;
    }

    /**
     * Sets the approximate column after which long lines will be splitted in the output
     * with a linebreak.
     * @param int $position
     */
    public function setLineBreakPosition($position)
    {
        $this-&gt;linebreakPosition = (int) $position;
    }

    /**
     * Sets the memory limit for this script
     * @param int|string $limit
     */
    public function setMemoryLimit($limit)
    {
        $this-&gt;memoryLimit = Utils::normalizeInt($limit);
    }

    /**
     * Sets the maximum execution time for this script
     * @param int|string $seconds
     */
    public function setMaxExecutionTime($seconds)
    {
        $this-&gt;maxExecutionTime = (int) $seconds;
    }

    /**
     * Sets the PCRE backtrack limit for this script
     * @param int $limit
     */
    public function setPcreBacktrackLimit($limit)
    {
        $this-&gt;pcreBacktrackLimit = (int) $limit;
    }

    /**
     * Sets the PCRE recursion limit for this script
     * @param int $limit
     */
    public function setPcreRecursionLimit($limit)
    {
        $this-&gt;pcreRecursionLimit = (int) $limit;
    }

    /**
     * Builds regular expressions needed for shortening zero values
     */
    private function setShortenZeroValuesRegexes()
    {
        $zeroRegex = &#039;0&#039;. $this-&gt;unitsGroupRegex;
        $numOrPosRegex = &#039;(&#039;. $this-&gt;numRegex .&#039;|top|left|bottom|right|center) &#039;;
        $oneZeroSafeProperties = array(
            &#039;(?:line-)?height&#039;,
            &#039;(?:(?:min|max)-)?width&#039;,
            &#039;top&#039;,
            &#039;left&#039;,
            &#039;background-position&#039;,
            &#039;bottom&#039;,
            &#039;right&#039;,
            &#039;border(?:-(?:top|left|bottom|right))?(?:-width)?&#039;,
            &#039;border-(?:(?:top|bottom)-(?:left|right)-)?radius&#039;,
            &#039;column-(?:gap|width)&#039;,
            &#039;margin(?:-(?:top|left|bottom|right))?&#039;,
            &#039;outline-width&#039;,
            &#039;padding(?:-(?:top|left|bottom|right))?&#039;
        );

        // First zero regex
        $regex = &#039;/(^|;)(&#039;. implode(&#039;|&#039;, $oneZeroSafeProperties) .&#039;):%s/Si&#039;;
        $this-&gt;shortenOneZeroesRegex = sprintf($regex, $zeroRegex);

        // Multiple zeroes regexes
        $regex = &#039;/(^|;)(margin|padding|border-(?:width|radius)|background-position):%s/Si&#039;;
        $this-&gt;shortenTwoZeroesRegex = sprintf($regex, $numOrPosRegex . $zeroRegex);
        $this-&gt;shortenThreeZeroesRegex = sprintf($regex, $numOrPosRegex . $numOrPosRegex . $zeroRegex);
        $this-&gt;shortenFourZeroesRegex = sprintf($regex, $numOrPosRegex . $numOrPosRegex . $numOrPosRegex . $zeroRegex);
    }

    /**
     * Resets properties whose value may change between runs
     */
    private function resetRunProperties()
    {
        $this-&gt;comments = array();
        $this-&gt;ruleBodies = array();
        $this-&gt;preservedTokens = array();
    }

    /**
     * Tries to configure PHP to use at least the suggested minimum settings
     * @return void
     */
    private function doRaisePhpLimits()
    {
        $phpLimits = array(
            &#039;memory_limit&#039; =&gt; $this-&gt;memoryLimit,
            &#039;max_execution_time&#039; =&gt; $this-&gt;maxExecutionTime,
            &#039;pcre.backtrack_limit&#039; =&gt; $this-&gt;pcreBacktrackLimit,
            &#039;pcre.recursion_limit&#039; =&gt;  $this-&gt;pcreRecursionLimit
        );

        // If current settings are higher respect them.
        foreach ($phpLimits as $name =&gt; $suggested) {
            $current = Utils::normalizeInt(ini_get($name));

            if ($current &gt;= $suggested) {
                continue;
            }

            // memoryLimit exception: allow -1 for &quot;no memory limit&quot;.
            if ($name === &#039;memory_limit&#039; &amp;&amp; $current === -1) {
                continue;
            }

            // maxExecutionTime exception: allow 0 for &quot;no memory limit&quot;.
            if ($name === &#039;max_execution_time&#039; &amp;&amp; $current === 0) {
                continue;
            }

            ini_set($name, $suggested);
        }
    }

    /**
     * Registers a preserved token
     * @param string $token
     * @return string The token ID string
     */
    private function registerPreservedToken($token)
    {
        $tokenId = sprintf(self::PRESERVED_TOKEN, count($this-&gt;preservedTokens));
        $this-&gt;preservedTokens[$tokenId] = $token;
        return $tokenId;
    }

    /**
     * Registers a candidate comment token
     * @param string $comment
     * @return string The comment token ID string
     */
    private function registerCommentToken($comment)
    {
        $tokenId = sprintf(self::COMMENT_TOKEN, count($this-&gt;comments));
        $this-&gt;comments[$tokenId] = $comment;
        return $tokenId;
    }

    /**
     * Registers a rule body token
     * @param string $body the minified rule body
     * @return string The rule body token ID string
     */
    private function registerRuleBodyToken($body)
    {
        if (empty($body)) {
            return &#039;&#039;;
        }

        $tokenId = sprintf(self::RULE_BODY_TOKEN, count($this-&gt;ruleBodies));
        $this-&gt;ruleBodies[$tokenId] = $body;
        return $tokenId;
    }

    /**
     * Parses &amp; minifies the given input CSS string
     * @param string $css
     * @return string
     */
    private function minify($css)
    {
        // Process data urls
        $css = $this-&gt;processDataUrls($css);

        // Process comments
        $css = preg_replace_callback(
            &#039;/(?&lt;!\\\\)\/\*(.*?)\*(?&lt;!\\\\)\//Ss&#039;,
            array($this, &#039;processCommentsCallback&#039;),
            $css
        );

        // IE7: Process Microsoft matrix filters (whitespaces between Matrix parameters). Can contain strings inside.
        $css = preg_replace_callback(
            &#039;/filter:\s*progid:DXImageTransform\.Microsoft\.Matrix\(([^)]+)\)/Ss&#039;,
            array($this, &#039;processOldIeSpecificMatrixDefinitionCallback&#039;),
            $css
        );

        // Process quoted unquotable attribute selectors to unquote them. Covers most common cases.
        // Likelyhood of a quoted attribute selector being a substring in a string: Very very low.
        $css = preg_replace(
            &#039;/\[\s*([a-z][a-z-]+)\s*([\*\|\^\$~]?=)\s*[\&#039;&quot;](-?[a-z_][a-z0-9-_]+)[\&#039;&quot;]\s*\]/Ssi&#039;,
            &#039;[$1$2$3]&#039;,
            $css
        );

        // Process strings so their content doesn&#039;t get accidentally minified
        $css = preg_replace_callback(
            &#039;/(?:&quot;(?:[^\\\\&quot;]|\\\\.|\\\\)*&quot;)|&#039;.&quot;(?:&#039;(?:[^\\\\&#039;]|\\\\.|\\\\)*&#039;)/S&quot;,
            array($this, &#039;processStringsCallback&#039;),
            $css
        );

        // Normalize all whitespace strings to single spaces. Easier to work with that way.
        $css = preg_replace(&#039;/\s+/S&#039;, &#039; &#039;, $css);
        
        // Process comments
        $css = $this-&gt;processComments($css);
        
        // Process rule bodies
        $css = $this-&gt;processRuleBodies($css);
        
        // Process at-rules and selectors
        $css = $this-&gt;processAtRulesAndSelectors($css);

        // Restore preserved rule bodies before splitting
        $css = strtr($css, $this-&gt;ruleBodies);

        // Some source control tools don&#039;t like it when files containing lines longer
        // than, say 8000 characters, are checked in. The linebreak option is used in
        // that case to split long lines after a specific column.
        if ($this-&gt;linebreakPosition &gt; 0) {
            $l = strlen($css);
            $offset = $this-&gt;linebreakPosition;
            while (preg_match(&#039;/(?&lt;!\\\\)\}(?!\n)/S&#039;, $css, $matches, PREG_OFFSET_CAPTURE, $offset)) {
                $matchIndex = $matches[0][1];
                $css = substr_replace($css, &quot;\n&quot;, $matchIndex + 1, 0);
                $offset = $matchIndex + 2 + $this-&gt;linebreakPosition;
                $l += 1;
                if ($offset &gt; $l) {
                    break;
                }
            }
        }

        // Restore preserved comments and strings
        $css = strtr($css, $this-&gt;preservedTokens);

        return trim($css);
    }

    /**
     * Searches &amp; replaces all data urls with tokens before we start compressing,
     * to avoid performance issues running some of the subsequent regexes against large string chunks.
     * @param string $css
     * @return string
     */
    private function processDataUrls($css)
    {
        $ret = &#039;&#039;;
        $searchOffset = $substrOffset = 0;

        // Since we need to account for non-base64 data urls, we need to handle
        // &#039; and ) being part of the data string.
        while (preg_match(&#039;/url\(\s*([&quot;\&#039;]?)data:/Si&#039;, $css, $m, PREG_OFFSET_CAPTURE, $searchOffset)) {
            $matchStartIndex = $m[0][1];
            $dataStartIndex = $matchStartIndex + 4; // url( length
            $searchOffset = $matchStartIndex + strlen($m[0][0]);
            $terminator = $m[1][0]; // &#039;, &quot; or empty (not quoted)
            $terminatorRegex = &#039;/(?&lt;!\\\\)&#039;. (strlen($terminator) === 0 ? &#039;&#039; : $terminator.&#039;\s*&#039;) .&#039;(\))/S&#039;;
            
            $ret .= substr($css, $substrOffset, $matchStartIndex - $substrOffset);

            // Terminator found
            if (preg_match($terminatorRegex, $css, $matches, PREG_OFFSET_CAPTURE, $searchOffset)) {
                $matchEndIndex = $matches[1][1];
                $searchOffset = $matchEndIndex + 1;
                $token = substr($css, $dataStartIndex, $matchEndIndex - $dataStartIndex);

                // Remove all spaces only for base64 encoded URLs.
                if (stripos($token, &#039;base64,&#039;) !== false) {
                    $token = preg_replace(&#039;/\s+/S&#039;, &#039;&#039;, $token);
                }

                $ret .= &#039;url(&#039;. $this-&gt;registerPreservedToken(trim($token)) .&#039;)&#039;;
            // No end terminator found, re-add the whole match. Should we throw/warn here?
            } else {
                $ret .= substr($css, $matchStartIndex, $searchOffset - $matchStartIndex);
            }

            $substrOffset = $searchOffset;
        }

        $ret .= substr($css, $substrOffset);

        return $ret;
    }

    /**
     * Registers all comments found as candidates to be preserved.
     * @param array $matches
     * @return string
     */
    private function processCommentsCallback($matches)
    {
        return &#039;/*&#039;. $this-&gt;registerCommentToken($matches[1]) .&#039;*/&#039;;
    }

    /**
     * Preserves old IE Matrix string definition
     * @param array $matches
     * @return string
     */
    private function processOldIeSpecificMatrixDefinitionCallback($matches)
    {
        return &#039;filter:progid:DXImageTransform.Microsoft.Matrix(&#039;. $this-&gt;registerPreservedToken($matches[1]) .&#039;)&#039;;
    }

    /**
     * Preserves strings found
     * @param array $matches
     * @return string
     */
    private function processStringsCallback($matches)
    {
        $match = $matches[0];
        $quote = substr($match, 0, 1);
        $match = substr($match, 1, -1);

        // maybe the string contains a comment-like substring?
        // one, maybe more? put&#039;em back then
        if (strpos($match, self::COMMENT_TOKEN_START) !== false) {
            $match = strtr($match, $this-&gt;comments);
        }

        // minify alpha opacity in filter strings
        $match = str_ireplace(&#039;progid:DXImageTransform.Microsoft.Alpha(Opacity=&#039;, &#039;alpha(opacity=&#039;, $match);

        return $quote . $this-&gt;registerPreservedToken($match) . $quote;
    }

    /**
     * Preserves or removes comments found.
     * @param string $css
     * @return string
     */
    private function processComments($css)
    {
        foreach ($this-&gt;comments as $commentId =&gt; $comment) {
            $commentIdString = &#039;/*&#039;. $commentId .&#039;*/&#039;;
            
            // ! in the first position of the comment means preserve
            // so push to the preserved tokens keeping the !
            if ($this-&gt;keepImportantComments &amp;&amp; strpos($comment, &#039;!&#039;) === 0) {
                $preservedTokenId = $this-&gt;registerPreservedToken($comment);
                // Put new lines before and after /*! important comments
                $css = str_replace($commentIdString, &quot;\n/*$preservedTokenId*/\n&quot;, $css);
                continue;
            }

            // # sourceMappingURL= in the first position of the comment means sourcemap
            // so push to the preserved tokens if {$this-&gt;keepSourceMapComment} is truthy.
            if ($this-&gt;keepSourceMapComment &amp;&amp; strpos($comment, &#039;# sourceMappingURL=&#039;) === 0) {
                $preservedTokenId = $this-&gt;registerPreservedToken($comment);
                // Add new line before the sourcemap comment
                $css = str_replace($commentIdString, &quot;\n/*$preservedTokenId*/&quot;, $css);
                continue;
            }

            // Keep empty comments after child selectors (IE7 hack)
            // e.g. html &gt;/**/ body
            if (strlen($comment) === 0 &amp;&amp; strpos($css, &#039;&gt;/*&#039;.$commentId) !== false) {
                $css = str_replace($commentId, $this-&gt;registerPreservedToken(&#039;&#039;), $css);
                continue;
            }

            // in all other cases kill the comment
            $css = str_replace($commentIdString, &#039;&#039;, $css);
        }

        // Normalize whitespace again
        $css = preg_replace(&#039;/ +/S&#039;, &#039; &#039;, $css);

        return $css;
    }

    /**
     * Finds, minifies &amp; preserves all rule bodies.
     * @param string $css the whole stylesheet.
     * @return string
     */
    private function processRuleBodies($css)
    {
        $ret = &#039;&#039;;
        $searchOffset = $substrOffset = 0;

        while (($blockStartPos = strpos($css, &#039;{&#039;, $searchOffset)) !== false) {
            $blockEndPos = strpos($css, &#039;}&#039;, $blockStartPos);
            $nextBlockStartPos = strpos($css, &#039;{&#039;, $blockStartPos + 1);
            $ret .= substr($css, $substrOffset, $blockStartPos - $substrOffset);

            if ($nextBlockStartPos !== false &amp;&amp; $nextBlockStartPos &lt; $blockEndPos) {
                $ret .= substr($css, $blockStartPos, $nextBlockStartPos - $blockStartPos);
                $searchOffset = $nextBlockStartPos;
            } else {
                $ruleBody = substr($css, $blockStartPos + 1, $blockEndPos - $blockStartPos - 1);
                $ruleBodyToken = $this-&gt;registerRuleBodyToken($this-&gt;processRuleBody($ruleBody));
                $ret .= &#039;{&#039;. $ruleBodyToken .&#039;}&#039;;
                $searchOffset = $blockEndPos + 1;
            }

            $substrOffset = $searchOffset;
        }

        $ret .= substr($css, $substrOffset);

        return $ret;
    }

    /**
     * Compresses non-group rule bodies.
     * @param string $body The rule body without curly braces
     * @return string
     */
    private function processRuleBody($body)
    {
        $body = trim($body);

        // Remove spaces before the things that should not have spaces before them.
        $body = preg_replace(&#039;/ ([:=,)*\/;\n])/S&#039;, &#039;$1&#039;, $body);

        // Remove the spaces after the things that should not have spaces after them.
        $body = preg_replace(&#039;/([:=,(*\/!;\n]) /S&#039;, &#039;$1&#039;, $body);
        
        // Replace multiple semi-colons in a row by a single one
        $body = preg_replace(&#039;/;;+/S&#039;, &#039;;&#039;, $body);

        // Remove semicolon before closing brace except when:
        // - The last property is prefixed with a `*` (lte IE7 hack) to avoid issues on Symbian S60 3.x browsers.
        if (!preg_match(&#039;/\*[a-z0-9-]+:[^;]+;$/Si&#039;, $body)) {
            $body = rtrim($body, &#039;;&#039;);
        }

        // Remove important comments inside a rule body (because they make no sense here).
        if (strpos($body, &#039;/*&#039;) !== false) {
            $body = preg_replace(&#039;/\n?\/\*[A-Z0-9_]+\*\/\n?/S&#039;, &#039;&#039;, $body);
        }
        
        // Empty rule body? Exit :)
        if (empty($body)) {
            return &#039;&#039;;
        }

        // Shorten font-weight values
        $body = preg_replace(
            array(&#039;/(font-weight:)bold\b/Si&#039;, &#039;/(font-weight:)normal\b/Si&#039;),
            array(&#039;${1}700&#039;, &#039;${1}400&#039;),
            $body
        );

        // Shorten background property
        $body = preg_replace(&#039;/(background:)(?:none|transparent)( !|;|$)/Si&#039;, &#039;${1}0 0$2&#039;, $body);

        // Shorten opacity IE filter
        $body = str_ireplace(&#039;progid:DXImageTransform.Microsoft.Alpha(Opacity=&#039;, &#039;alpha(opacity=&#039;, $body);

        // Shorten colors from rgb(51,102,153) to #336699, rgb(100%,0%,0%) to #ff0000 (sRGB color space)
        // Shorten colors from hsl(0, 100%, 50%) to #ff0000 (sRGB color space)
        // This makes it more likely that it&#039;ll get further compressed in the next step.
        $body = preg_replace_callback(
            &#039;/(rgb|hsl)\(([0-9,.% -]+)\)(.|$)/Si&#039;,
            array($this, &#039;shortenHslAndRgbToHexCallback&#039;),
            $body
        );

        // Shorten colors from #AABBCC to #ABC or shorter color name:
        // - Look for hex colors which don&#039;t have a &quot;=&quot; in front of them (to avoid MSIE filters)
        $body = preg_replace_callback(
            &#039;/(?&lt;!=)#([0-9a-f]{3,6})( |,|\)|;|$)/Si&#039;,
            array($this, &#039;shortenHexColorsCallback&#039;),
            $body
        );

        // Shorten long named colors with a shorter HEX counterpart: white -&gt; #fff.
        // Run at least 2 times to cover most cases
        $body = preg_replace_callback(
            array($this-&gt;namedToHexColorsRegex, $this-&gt;namedToHexColorsRegex),
            array($this, &#039;shortenNamedColorsCallback&#039;),
            $body
        );

        // Replace positive sign from numbers before the leading space is removed.
        // +1.2em to 1.2em, +.8px to .8px, +2% to 2%
        $body = preg_replace(&#039;/([ :,(])\+(\.?\d+)/S&#039;, &#039;$1$2&#039;, $body);

        // shorten ms to s
        $body = preg_replace_callback(&#039;/([ :,(])(-?)(\d{3,})ms/Si&#039;, function ($matches) {
            return $matches[1] . $matches[2] . ((int) $matches[3] / 1000) .&#039;s&#039;;
        }, $body);

        // Remove leading zeros from integer and float numbers.
        // 000.6 to .6, -0.8 to -.8, 0050 to 50, -01.05 to -1.05
        $body = preg_replace(&#039;/([ :,(])(-?)0+([1-9]?\.?\d+)/S&#039;, &#039;$1$2$3&#039;, $body);

        // Remove trailing zeros from float numbers.
        // -6.0100em to -6.01em, .0100 to .01, 1.200px to 1.2px
        $body = preg_replace(&#039;/([ :,(])(-?\d?\.\d+?)0+([^\d])/S&#039;, &#039;$1$2$3&#039;, $body);

        // Remove trailing .0 -&gt; -9.0 to -9
        $body = preg_replace(&#039;/([ :,(])(-?\d+)\.0([^\d])/S&#039;, &#039;$1$2$3&#039;, $body);

        // Replace 0 length numbers with 0
        $body = preg_replace(&#039;/([ :,(])-?\.?0+([^\d])/S&#039;, &#039;${1}0$2&#039;, $body);

        // Shorten zero values for safe properties only
        $body = preg_replace(
            array(
                $this-&gt;shortenOneZeroesRegex,
                $this-&gt;shortenTwoZeroesRegex,
                $this-&gt;shortenThreeZeroesRegex,
                $this-&gt;shortenFourZeroesRegex
            ),
            array(
                &#039;$1$2:0&#039;,
                &#039;$1$2:$3 0&#039;,
                &#039;$1$2:$3 $4 0&#039;,
                &#039;$1$2:$3 $4 $5 0&#039;
            ),
            $body
        );

        // Replace 0 0 0; or 0 0 0 0; with 0 0 for background-position property.
        $body = preg_replace(&#039;/(background-position):0(?: 0){2,3}( !|;|$)/Si&#039;, &#039;$1:0 0$2&#039;, $body);

        // Shorten suitable shorthand properties with repeated values
        $body = preg_replace(
            array(
                &#039;/(margin|padding|border-(?:width|radius)):(&#039;.$this-&gt;numRegex.&#039;)(?: \2)+( !|;|$)/Si&#039;,
                &#039;/(border-(?:style|color)):([#a-z0-9]+)(?: \2)+( !|;|$)/Si&#039;
            ),
            &#039;$1:$2$3&#039;,
            $body
        );
        $body = preg_replace(
            array(
                &#039;/(margin|padding|border-(?:width|radius)):&#039;.
                &#039;(&#039;.$this-&gt;numRegex.&#039;) (&#039;.$this-&gt;numRegex.&#039;) \2 \3( !|;|$)/Si&#039;,
                &#039;/(border-(?:style|color)):([#a-z0-9]+) ([#a-z0-9]+) \2 \3( !|;|$)/Si&#039;
            ),
            &#039;$1:$2 $3$4&#039;,
            $body
        );
        $body = preg_replace(
            array(
                &#039;/(margin|padding|border-(?:width|radius)):&#039;.
                &#039;(&#039;.$this-&gt;numRegex.&#039;) (&#039;.$this-&gt;numRegex.&#039;) (&#039;.$this-&gt;numRegex.&#039;) \3( !|;|$)/Si&#039;,
                &#039;/(border-(?:style|color)):([#a-z0-9]+) ([#a-z0-9]+) ([#a-z0-9]+) \3( !|;|$)/Si&#039;
            ),
            &#039;$1:$2 $3 $4$5&#039;,
            $body
        );

        // Lowercase some common functions that can be values
        $body = preg_replace_callback(
            &#039;/(?:attr|blur|brightness|circle|contrast|cubic-bezier|drop-shadow|ellipse|from|grayscale|&#039;.
            &#039;hsla?|hue-rotate|inset|invert|local|minmax|opacity|perspective|polygon|rgba?|rect|repeat|saturate|sepia|&#039;.
            &#039;steps|to|url|var|-webkit-gradient|&#039;.
            &#039;(?:-(?:atsc|khtml|moz|ms|o|wap|webkit)-)?(?:calc|(?:repeating-)?(?:linear|radial)-gradient))\(/Si&#039;,
            array($this, &#039;strtolowerCallback&#039;),
            $body
        );

        // Lowercase all uppercase properties
        $body = preg_replace_callback(&#039;/(?:^|;)[A-Z-]+:/S&#039;, array($this, &#039;strtolowerCallback&#039;), $body);

        return $body;
    }

    /**
     * Compresses At-rules and selectors.
     * @param string $css the whole stylesheet with rule bodies tokenized.
     * @return string
     */
    private function processAtRulesAndSelectors($css)
    {
        $charset = &#039;&#039;;
        $imports = &#039;&#039;;
        $namespaces = &#039;&#039;;
        
        // Remove spaces before the things that should not have spaces before them.
        $css = preg_replace(&#039;/ ([@{};&gt;+)\]~=,\/\n])/S&#039;, &#039;$1&#039;, $css);

        // Remove the spaces after the things that should not have spaces after them.
        $css = preg_replace(&#039;/([{}:;&gt;+(\[~=,\/\n]) /S&#039;, &#039;$1&#039;, $css);
        
        // Shorten shortable double colon (CSS3) pseudo-elements to single colon (CSS2)
        $css = preg_replace(&#039;/::(before|after|first-(?:line|letter))(\{|,)/Si&#039;, &#039;:$1$2&#039;, $css);

        // Retain space for special IE6 cases
        $css = preg_replace_callback(&#039;/:first-(line|letter)(\{|,)/Si&#039;, function ($matches) {
            return &#039;:first-&#039;. strtolower($matches[1]) .&#039; &#039;. $matches[2];
        }, $css);

        // Find a fraction that may used in some @media queries such as: (min-aspect-ratio: 1/1)
        // Add token to add the &quot;/&quot; back in later
        $css = preg_replace(&#039;/\(([a-z-]+):([0-9]+)\/([0-9]+)\)/Si&#039;, &#039;($1:$2&#039;. self::QUERY_FRACTION .&#039;$3)&#039;, $css);

        // Remove empty rule blocks up to 2 levels deep.
        $css = preg_replace(array_fill(0, 2, &#039;/(\{)[^{};\/\n]+\{\}/S&#039;), &#039;$1&#039;, $css);
        $css = preg_replace(&#039;/[^{};\/\n]+\{\}/S&#039;, &#039;&#039;, $css);

        // Two important comments next to each other? Remove extra newline.
        if ($this-&gt;keepImportantComments) {
            $css = str_replace(&quot;\n\n&quot;, &quot;\n&quot;, $css);
        }
        
        // Restore fraction
        $css = str_replace(self::QUERY_FRACTION, &#039;/&#039;, $css);

        // Lowercase some popular @directives
        $css = preg_replace_callback(
            &#039;/(?&lt;!\\\\)@(?:charset|document|font-face|import|(?:-(?:atsc|khtml|moz|ms|o|wap|webkit)-)?keyframes|media|&#039;.
            &#039;namespace|page|supports|viewport)/Si&#039;,
            array($this, &#039;strtolowerCallback&#039;),
            $css
        );

        // Lowercase some popular media types
        $css = preg_replace_callback(
            &#039;/[ ,](?:all|aural|braille|handheld|print|projection|screen|tty|tv|embossed|speech)[ ,;{]/Si&#039;,
            array($this, &#039;strtolowerCallback&#039;),
            $css
        );

        // Lowercase some common pseudo-classes &amp; pseudo-elements
        $css = preg_replace_callback(
            &#039;/(?&lt;!\\\\):(?:active|after|before|checked|default|disabled|empty|enabled|first-(?:child|of-type)|&#039;.
            &#039;focus(?:-within)?|hover|indeterminate|in-range|invalid|lang\(|last-(?:child|of-type)|left|link|not\(|&#039;.
            &#039;nth-(?:child|of-type)\(|nth-last-(?:child|of-type)\(|only-(?:child|of-type)|optional|out-of-range|&#039;.
            &#039;read-(?:only|write)|required|right|root|:selection|target|valid|visited)/Si&#039;,
            array($this, &#039;strtolowerCallback&#039;),
            $css
        );
        
        // @charset handling
        if (preg_match($this-&gt;charsetRegex, $css, $matches)) {
            // Keep the first @charset at-rule found
            $charset = $matches[0];
            // Delete all @charset at-rules
            $css = preg_replace($this-&gt;charsetRegex, &#039;&#039;, $css);
        }

        // @import handling
        $css = preg_replace_callback($this-&gt;importRegex, function ($matches) use (&amp;$imports) {
            // Keep all @import at-rules found for later
            $imports .= $matches[0];
            // Delete all @import at-rules
            return &#039;&#039;;
        }, $css);

        // @namespace handling
        $css = preg_replace_callback($this-&gt;namespaceRegex, function ($matches) use (&amp;$namespaces) {
            // Keep all @namespace at-rules found for later
            $namespaces .= $matches[0];
            // Delete all @namespace at-rules
            return &#039;&#039;;
        }, $css);
        
        // Order critical at-rules:
        // 1. @charset first
        // 2. @imports below @charset
        // 3. @namespaces below @imports
        $css = $charset . $imports . $namespaces . $css;

        return $css;
    }

    /**
     * Converts hsl() &amp; rgb() colors to HEX format.
     * @param $matches
     * @return string
     */
    private function shortenHslAndRgbToHexCallback($matches)
    {
        $type = $matches[1];
        $values = explode(&#039;,&#039;, $matches[2]);
        $terminator = $matches[3];
        
        if ($type === &#039;hsl&#039;) {
            $values = Utils::hslToRgb($values);
        }
        
        $hexColors = Utils::rgbToHex($values);

        // Restore space after rgb() or hsl() function in some cases such as:
        // background-image: linear-gradient(to bottom, rgb(210,180,140) 10%, rgb(255,0,0) 90%);
        if (!empty($terminator) &amp;&amp; !preg_match(&#039;/[ ,);]/S&#039;, $terminator)) {
            $terminator = &#039; &#039;. $terminator;
        }

        return &#039;#&#039;. implode(&#039;&#039;, $hexColors) . $terminator;
    }

    /**
     * Compresses HEX color values of the form #AABBCC to #ABC or short color name.
     * @param $matches
     * @return string
     */
    private function shortenHexColorsCallback($matches)
    {
        $hex = $matches[1];
        
        // Shorten suitable 6 chars HEX colors
        if (strlen($hex) === 6 &amp;&amp; preg_match(&#039;/^([0-9a-f])\1([0-9a-f])\2([0-9a-f])\3$/Si&#039;, $hex, $m)) {
            $hex = $m[1] . $m[2] . $m[3];
        }
        
        // Lowercase
        $hex = &#039;#&#039;. strtolower($hex);

        // Replace Hex colors with shorter color names
        $color = array_key_exists($hex, $this-&gt;hexToNamedColorsMap) ? $this-&gt;hexToNamedColorsMap[$hex] : $hex;

        return $color . $matches[2];
    }

    /**
     * Shortens all named colors with a shorter HEX counterpart for a set of safe properties
     * e.g. white -&gt; #fff
     * @param array $matches
     * @return string
     */
    private function shortenNamedColorsCallback($matches)
    {
        return $matches[1] . $this-&gt;namedToHexColorsMap[strtolower($matches[2])] . $matches[3];
    }

    /**
     * Makes a string lowercase
     * @param array $matches
     * @return string
     */
    private function strtolowerCallback($matches)
    {
        return strtolower($matches[0]);
    }
}
</code></pre>
            </article>
                <section data-search-results class="phpdocumentor-search-results phpdocumentor-search-results--hidden">
    <section class="phpdocumentor-search-results__dialog">
        <header class="phpdocumentor-search-results__header">
            <h2 class="phpdocumentor-search-results__title">Search results</h2>
            <button class="phpdocumentor-search-results__close"><i class="fas fa-times"></i></button>
        </header>
        <section class="phpdocumentor-search-results__body">
            <ul class="phpdocumentor-search-results__entries"></ul>
        </section>
    </section>
</section>
            </div>
        </div>
        <a href="files/http-concat-cssmin-minifier.html#top" class="phpdocumentor-back-to-top"><i class="fas fa-chevron-circle-up"></i></a>

    </main>

    <script>
        cssVars({});
    </script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/prism.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
</body>
</html>
